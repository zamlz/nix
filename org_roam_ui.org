:PROPERTIES:
:ID:       35a045cf-09f3-4a47-9a2d-b9cedd97c183
:ROAM_REFS: https://github.com/org-roam/org-roam-ui
:END:
#+TITLE: Org-roam UI
#+AUTHOR: Amlesh Sivanantham (zamlz)
#+CREATED: [2021-09-29 Wed 13:06]
#+LAST_MODIFIED: [2021-10-14 Thu 14:23:49]
#+FILETAGS: CONFIG SOFTWARE

* Frontend for Org-roam
=org-roam-ui= is meant as the successor for [[https://github.com/org-roam/org-roam-server][Org-roam-server]]

* Configuration
:PROPERTIES:
:header-args:emacs-lisp: :tangle ~/.config/emacs/lisp/init-org-roam-ui.el :comments both :mkdirp yes
:END:

** Setup Dependencies
We need to make sure [[id:e6532b52-0b06-406f-a7ed-89591de98b40][Org-roam]] is setup first.

#+begin_src emacs-lisp
(require 'init-org-roam)
#+end_src

** Package Install

#+begin_src emacs-lisp
(use-package org-roam-ui
  :straight (:host github :repo "org-roam/org-roam-ui" :branch "main" :files ("*.el" "out"))
  :after org-roam)
#+end_src

** Customize Parameters

#+begin_src emacs-lisp
(setq org-roam-ui-sync-theme t)
(setq org-roam-ui-follow t)
(setq org-roam-ui-update-on-save t)
(setq org-roam-ui-open-on-start nil)
#+end_src

** Initialize Server
Run the server if we are running in =daemon= mode.

#+begin_src emacs-lisp
(when (daemonp)
  (add-hook 'after-init-hook #'org-roam-ui-mode))
#+end_src

** Feature Provide

#+begin_src emacs-lisp
(provide 'init-org-roam-ui)
#+end_src

* Integration with Surf
:PROPERTIES:
:header-args:shell: :tangle ~/.config/xinitrc.d/surf-org-roam-ui.sh :mkdirp yes :shebang #!/bin/sh :comments both
:END:
In order to keep my browser session seperate from the =org-roam-ui= webapp, I use the [[id:72c745dd-8faa-4926-b84e-ed9761c8ce9d][Surf Browser]]. Let's ensure that it gets started at login by creating a [[id:64c66aeb-1b89-4f51-8e36-2931fb24399a][xinit]] user level scripts. Here we control the position and size of the browser with [[id:3c22f3fd-a4a1-4c08-9ee4-336d5c6491fa][herbstluftwm]].

#+begin_src shell
# start a subshell so we don't block other things from loading
(
    # delay by 2 seconds so emacs daemon has time to load
    sleep 2
    if [ -n "$(pgrep -f 'emacs --daemon=xorg-emacs-daemon')" ] && \
       [ -f "~/.config/enable_surf" ]; &&
       [ -z "$(pgrep -f 'surf http://127.0.0.1:35901/')" ]; then

        fix_surf_window() {
            herbstclient lower "$1"
            xdotool windowmove "$1" 0 20
            width=$(xwininfo -root|grep -E '  Width:'|cut -d ':' -f2)
            height=$(($(xwininfo -root|grep -E '  Height:'|cut -d ':' -f2) - 40))
            xdotool windowsize "$1" ${width} ${height}
        }

        # fork this too so we don't block things
        fix_surf_window $(herbstclient --last-arg --wait rule surfdesktop) &
        surf "http://127.0.0.1:35901/" &
    fi

) &
#+end_src
