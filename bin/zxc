#!/usr/bin/env sh

# [z]amlz's e[x]treme [c]onfigurator
# IDK, I had to think of an acronym for zxc

. $HOME/lib/shell/logging && eval "$(get_logger $0)"

# A simple script that manages dotfiles repo and beyond
. $HOME/lib/repos
. $HOME/lib/shell/colorenv

help_prompt() {
    echo "Usage: $(basename $0) [CMD]"
    echo "    Commands:"
    echo "      - setup: Runs dotfiles setup files (and xcolor symlinks setup)"
}

# Configure dotfiles in the current directory
# (Used when installing new distros)
setup_dots() {
    HOME="${1:-$HOME}"

    # setup phase
    $HOME/etc/git/setup.sh
    $HOME/etc/gnupg/setup.sh
    $HOME/etc/picom/setup.sh
    $HOME/etc/polybar/setup.sh
    $HOME/etc/qutebrowser/setup.sh
    $HOME/etc/rofi/setup.sh
    $HOME/etc/ssh/setup.sh
    $HOME/etc/vim/setup.sh
    $HOME/etc/xorg/setup.sh
    $HOME/etc/zsh/setup.sh
}

# Run a git command (${2-}) in a given repo (${1})
run_git() {
    REPO_DIR=$1 && shift && GIT_ARGS=$@;
    echo -e "[${Bold}REPOSITORY: ${Blue}${REPO_DIR}${Rst}]"
    echo "git -C $REPO_DIR $GIT_ARGS"
    git -C $REPO_DIR $GIT_ARGS
}

run_git_over_all() {
    GIT_ARGS=$@;
    run_git ${DOTFILES_DIR} $GIT_ARGS;
}

if [ -z "$@" ]; then
    CMD="" && ARGS=""
else
    CMD=$1 && shift && ARGS=$@
fi

case "$CMD" in
    "fetch")        run_git_over_all "fetch --all"    ;;
    "info")         cat $HOME/lib/repos               ;;
    "setup")        setup_dots $ARGS                  ;;
    "-h")           help_prompt                       ;;
    "help")         help_prompt                       ;;
    *)              run_git_over_all "status --short" ;;
esac
